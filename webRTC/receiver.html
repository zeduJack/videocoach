<!DOCTYPE html>
<html>
<head>
    <title>Peer B - Receiver</title>
</head>
<body>
<div id="videoContainer"></div>
<script src="https://cdn.socket.io/4.4.1/socket.io.min.js"></script>
<script>


    const socket = io('https://192.168.43.30:443');  // Connects to the server hosting the page
    const remoteVideo = document.getElementById('remoteVideo');
    const peerConnection = new RTCPeerConnection();

    const roomId = '0';

    peerConnection.ontrack = event => {
        const stream = event.streams.at(-1);
        if (!document.getElementById(`video-${stream.id}`)) {
            const videoElem = document.createElement('video');
            videoElem.id = `video-${stream.id}`;
            const [remoteStream] = event.streams;
            videoElem.srcObject = remoteStream;
            videoElem.autoplay = true;
            videoElem.controls = true;
            videoElem.playsInline = true; // Recommended for web browsers on mobile devices

            // Append the new video element to the container
            document.getElementById('videoContainer').appendChild(videoElem);
        }
    };

    peerConnection.onicecandidate = event => {
      if (event.candidate) {
        socket.emit('candidate', roomId, event.candidate);
      }
    };

    socket.on('offer', (offer) => {
      peerConnection.setRemoteDescription(new RTCSessionDescription(offer));
      peerConnection.createAnswer().then(answer => {
        peerConnection.setLocalDescription(answer);
        socket.emit('answer', roomId, answer);
      });
    });

    socket.on('candidate', (candidate) => {
      peerConnection.addIceCandidate(new RTCIceCandidate(candidate));
    });

    socket.emit('create or join', roomId);
</script>
</body>
</html>
